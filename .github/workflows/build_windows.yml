name: Build and Publish Velopack Windows

run-name: Release Windows v${{ inputs.version }}

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'The version for the Velopack package'
        required: true
        default: '1.0.0'

defaults:
  run:
    shell: pwsh

jobs:
  build-and-publish:
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v5

      - name: Set up .NET Core
        uses: actions/setup-dotnet@v5
        with:
          dotnet-version: '9.x'

      - name: Install Velopack CLI
        run: dotnet tool install -g vpk
        
      - name: Build and Publish
        run: |
          dotnet publish -c Release -r win-x64 --self-contained true -p:PublishSingleFile=true -o ${{github.workspace}}/publish/win-x64
          vpk pack --packId Aniki --packVersion ${{ inputs.version }} --packDir ./publish/win-x64 --mainExe Aniki.exe
          vpk upload github --repoUrl https://github.com/TrueTheos/Aniki --token ${{ secrets.YOUR_PAT_TOKEN }} --releaseName ${{ inputs.version }}-windows