<!-- ReSharper disable Xaml.StyleClassNotFound -->
<UserControl
    x:Class="Aniki.Views.AnimeDetailsView"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="clr-namespace:Aniki.Models;assembly=Aniki"
    xmlns:mal="clr-namespace:Aniki.Models.MAL;assembly=Aniki"
    xmlns:views="clr-namespace:Aniki.Views;assembly=Aniki"
    xmlns:asyncImageLoader="clr-namespace:AsyncImageLoader;assembly=AsyncImageLoader.Avalonia"
    xmlns:vm="clr-namespace:Aniki.ViewModels;assembly=Aniki"
    x:DataType="vm:AnimeDetailsViewModel">
    <Border
        x:Name="Root"
        Padding="0"
        Background="{StaticResource BackgroundBlack}">
        <ScrollViewer>
            <Grid RowDefinitions="Auto,Auto">
                <!-- Hero Section with Blurred Background -->
                <Grid Row="0" Height="600">
                    <!-- Blurred Background Image -->
                    <Image asyncImageLoader:ImageLoader.Source="{Binding Details.MainPicture.Large}"
                           Stretch="UniformToFill"
                           Height="550"
                           VerticalAlignment="Top">
                        <Image.Effect>
                            <BlurEffect Radius="35"/>
                        </Image.Effect>
                    </Image>
                    
                    <!-- Dark Overlay -->
                    <Border Background="#AA000000"/>
                    
                    <!-- Main Content Grid -->
                    <Grid Margin="50,100,50,50">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="330"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- LEFT COLUMN: Poster + Rating + Reviews Info -->
                        <Grid Grid.Column="0" RowDefinitions="Auto,Auto,Auto,Auto" Margin="0,50,0,0">
                            <!-- Poster with overlapping rating badge -->
                            <Grid Grid.Row="0" Height="495">
                                <!-- Poster -->
                                <Border CornerRadius="12"
                                        BoxShadow="0 10 40 #80000000"
                                        Width="330"
                                        Height="495"
                                        ClipToBounds="True"
                                        VerticalAlignment="Top">
                                    <Image asyncImageLoader:ImageLoader.Source="{Binding Details.MainPicture.Large}"
                                           Stretch="UniformToFill"/>
                                </Border>
                                
                                <!-- Rating Badge (overlapping bottom of poster) -->
                                <Border Background="#1F1F1F"
                                        CornerRadius="20"
                                        Padding="16,10"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Bottom"
                                        Margin="0,0,0,-20"
                                        BoxShadow="0 4 12 #40000000">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <PathIcon Data="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
                                                  Width="20"
                                                  Height="20"
                                                  Foreground="#FFD700"/>
                                        <TextBlock Text="{Binding Details.Mean, StringFormat='{}{0:0.0}'}"
                                                   FontSize="20"
                                                   FontWeight="Bold"
                                                   Foreground="White"
                                                   VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Border>
                            </Grid>
                            
                            <!-- Reviews/Comments/Views Info -->
                            <StackPanel Grid.Row="1" 
                                        Margin="0,30,0,15"
                                        Spacing="2"
                                        HorizontalAlignment="Center">
                                <TextBlock FontSize="13" 
                                           Foreground="#999999"
                                           HorizontalAlignment="Center">
                                    <Run Text="19 reviews"/>
                                </TextBlock>
                                <StackPanel Orientation="Horizontal" 
                                            Spacing="8"
                                            HorizontalAlignment="Center">
                                    <TextBlock FontSize="13" Foreground="#999999">
                                        <Run Text="15 comments"/>
                                    </TextBlock>
                                    <TextBlock Text="•" FontSize="13" Foreground="#666666"/>
                                    <TextBlock FontSize="13" Foreground="#999999">
                                        <Run Text="230 views"/>
                                    </TextBlock>
                                </StackPanel>
                            </StackPanel>
                            
                            <!-- View Reviews Button -->
                            <Button Grid.Row="2"
                                    Background="Transparent"
                                    BorderBrush="#444444"
                                    BorderThickness="1"
                                    CornerRadius="8"
                                    Padding="0,12"
                                    HorizontalAlignment="Stretch"
                                    Content="View reviews"
                                    Foreground="#CCCCCC"
                                    FontSize="14"
                                    FontWeight="SemiBold"
                                    HorizontalContentAlignment="Center"/>
                        </Grid>
                        
                        <!-- RIGHT COLUMN: Title + All Info -->
                        <StackPanel Grid.Column="1" Margin="40,0,0,50" Spacing="0" VerticalAlignment="Bottom">
                            <!-- Title -->
                            <TextBlock Text="{Binding Details.Title}"
                                       FontSize="56"
                                       FontWeight="Bold"
                                       Foreground="White"
                                       TextWrapping="Wrap"
                                       Margin="0,0,0,6"/>
                            
                            <!-- Japanese Title + Metadata -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,20" Spacing="10">
                                <TextBlock Text="{Binding Details.AlternativeTitles.Ja}"
                                           FontSize="14"
                                           Foreground="#AAAAAA"/>
                                <TextBlock Text="•" 
                                           FontSize="14"
                                           Foreground="#777777"/>
                                <TextBlock Text="{Binding Details.StartDate}"
                                           FontSize="14"
                                           Foreground="#AAAAAA"/>
                                <TextBlock Text="•" 
                                           FontSize="14"
                                           Foreground="#777777"/>
                                <TextBlock  Text="{Binding Details.NumEpisodes, StringFormat='{}{0} episodes'}"
                                            FontSize="14"
                                            Foreground="#AAAAAA">
                                </TextBlock>
                            </StackPanel>
                            
                            <!-- Action Buttons -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,30" Spacing="12">
                                <Button Background="#E50914" 
                                        BorderThickness="0"
                                        CornerRadius="6"
                                        Padding="28,13"
                                        Cursor="Hand">
                                    <StackPanel Orientation="Horizontal" Spacing="10">
                                        <PathIcon Data="M8 5v14l11-7z" 
                                                  Width="16" 
                                                  Height="16"
                                                  Foreground="White"/>
                                        <TextBlock Text="Watching" 
                                                   FontSize="15"
                                                   FontWeight="SemiBold"
                                                   Foreground="White"/>
                                    </StackPanel>
                                </Button>
                                
                                <Button Background="#3A3A3A"
                                        BorderThickness="0"
                                        CornerRadius="6"
                                        Padding="28,13"
                                        Cursor="Hand">
                                    <StackPanel Orientation="Horizontal" Spacing="10">
                                        <PathIcon Data="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" 
                                                  Width="16" 
                                                  Height="16"
                                                  Foreground="White"/>
                                        <TextBlock Text="Review" 
                                                   FontSize="15"
                                                   FontWeight="SemiBold"
                                                   Foreground="White"/>
                                    </StackPanel>
                                </Button>
                                
                                <Button Background="#3A3A3A"
                                        BorderThickness="0"
                                        Width="50"
                                        Height="50"
                                        CornerRadius="25"
                                        Cursor="Hand">
                                    <PathIcon Data="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" 
                                              Width="22" 
                                              Height="22"
                                              Foreground="White"/>
                                </Button>
                                
                                <Button Background="#3A3A3A"
                                        BorderThickness="0"
                                        Width="50"
                                        Height="50"
                                        CornerRadius="25"
                                        Cursor="Hand">
                                    <PathIcon Data="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z" 
                                              Width="22" 
                                              Height="22"
                                              Foreground="White"/>
                                </Button>
                            </StackPanel>
                            
                            <!-- Authors and Trailer Row -->
                            <Grid Margin="0,0,0,25">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- Authors -->
                                <StackPanel Grid.Column="0" Spacing="12">
                                    <TextBlock Text="Authors" 
                                               FontSize="12"
                                               Foreground="#888888"
                                               FontWeight="SemiBold"
                                               LetterSpacing="1"/>
                                    <StackPanel Orientation="Horizontal" Spacing="-14">
                                        <Border Width="42" 
                                                Height="42" 
                                                CornerRadius="21"
                                                Background="#4A4A4A"
                                                BorderBrush="#1A1A1A"
                                                BorderThickness="3"/>
                                        <Border Width="42" 
                                                Height="42" 
                                                CornerRadius="21"
                                                Background="#4A4A4A"
                                                BorderBrush="#1A1A1A"
                                                BorderThickness="3"/>
                                        <Border Width="42" 
                                                Height="42" 
                                                CornerRadius="21"
                                                Background="#4A4A4A"
                                                BorderBrush="#1A1A1A"
                                                BorderThickness="3"/>
                                        <Border Width="42" 
                                                Height="42" 
                                                CornerRadius="21"
                                                Background="#2A2A2A"
                                                BorderBrush="#1A1A1A"
                                                BorderThickness="3">
                                            <TextBlock Text="+9"
                                                       FontSize="13"
                                                       Foreground="#AAAAAA"
                                                       FontWeight="SemiBold"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"/>
                                        </Border>
                                    </StackPanel>
                                </StackPanel>
                                
                                <!-- Trailer -->
                                <StackPanel Grid.Column="2" Spacing="12">
                                    <TextBlock Text="Trailer" 
                                               FontSize="12"
                                               Foreground="#888888"
                                               FontWeight="SemiBold"
                                               LetterSpacing="1"/>
                                    <Border Width="120" 
                                            Height="68" 
                                            CornerRadius="8"
                                            Background="#FF4444"
                                            ClipToBounds="True"
                                            Cursor="Hand"
                                            BoxShadow="0 4 16 #40000000">
                                        <Grid>
                                            <Image Stretch="UniformToFill"
                                                   asyncImageLoader:ImageLoader.Source="{Binding Details.Videos[0].Thumbnail}"/>
                                            <Border Background="#55000000">
                                                <Ellipse Width="32" 
                                                         Height="32"
                                                         Fill="#DDFFFFFF"
                                                         HorizontalAlignment="Center"
                                                         VerticalAlignment="Center"/>
                                            </Border>
                                            <PathIcon Data="M10 8v8l6-4z"
                                                      Width="16"
                                                      Height="16"
                                                      Foreground="#E50914"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Center"/>
                                        </Grid>
                                    </Border>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Grid>
                </Grid>
                
                <Grid Row="1" Margin="100,0,50,60">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="330"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="1">
                        <!-- Synopsis -->
                        <TextBlock Text="{Binding Details.Synopsis}"
                                   FontSize="15"
                                   Foreground="#CCCCCC"
                                   TextWrapping="Wrap"
                                   LineHeight="24"
                                   Margin="0,0,0,20"/>
                                
                        <!-- Genre Tags -->
                        <ItemsControl ItemsSource="{Binding Details.Genres}" Margin="0,0,0,20">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="mal:MAL_Genre">
                                    <Border Background="#44E50914"
                                            CornerRadius="16"
                                            Padding="16,8"
                                            Margin="0,0,10,10">
                                        <TextBlock Text="{Binding Name}"
                                                   FontSize="13"
                                                   Foreground="#FF6B8E"
                                                   FontWeight="Medium"/>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        
                        <ScrollViewer HorizontalScrollBarVisibility="Auto" 
                                      VerticalScrollBarVisibility="Disabled">
                            <ItemsControl ItemsSource="{Binding Details.Videos}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Orientation="Horizontal" Spacing="20"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate DataType="mal:MAL_Video">
                                        <Border Width="380"
                                                Height="214"
                                                CornerRadius="10"
                                                ClipToBounds="True"
                                                BoxShadow="0 6 24 #50000000"
                                                Cursor="Hand">
                                            <Image asyncImageLoader:ImageLoader.Source="{Binding Thumbnail}"
                                                   Stretch="UniformToFill"/>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </StackPanel>
                </Grid>
            </Grid>
        </ScrollViewer>
    </Border>
</UserControl>