<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:Aniki.ViewModels;assembly=Aniki"
        xmlns:models="clr-namespace:Aniki.Models;assembly=Aniki"
		x:DataType="vm:MainViewModel"
        mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
        x:Class="Aniki.Views.MainWindow"
        Title="Aniki - MyAnimeList Client"
        Background="Transparent"
        TransparencyLevelHint="AcrylicBlur"
        ExtendClientAreaToDecorationsHint="True">

	<Design.DataContext>
		<vm:MainViewModel/>
	</Design.DataContext>

	<Window.Styles>
		<Style Selector="ComboBox">
			<Setter Property="Background" Value="#3E3E3E"/>
			<Setter Property="Foreground" Value="#E0E0E0"/>
		</Style>
		<Style Selector="ListBoxItem">
			<Setter Property="Padding" Value="0"/>
			<Setter Property="Margin" Value="0,2"/>
		</Style>
		<Style Selector="ScrollBar">
			<Setter Property="Background" Value="#333333"/>
			<Setter Property="MinWidth" Value="16"/>
		</Style>
		<Style Selector="Panel.detailPanel TextBlock">
			<Setter Property="Foreground" Value="White"/>
		</Style>
		<Style Selector="Panel.detailPanel TextBlock.label">
			<Setter Property="Foreground" Value="LightGray"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="Margin" Value="0,0,5,0"/>
		</Style>
		<Style Selector="Panel.detailPanel TextBlock.value">
			<Setter Property="Foreground" Value="White"/>
		</Style>
	</Window.Styles>

	<Panel>
		<!-- Main background with blur effect -->
		<ExperimentalAcrylicBorder IsHitTestVisible="False">
			<ExperimentalAcrylicBorder.Material>
				<ExperimentalAcrylicMaterial
                    BackgroundSource="Digger"
                    TintColor="#202020"
                    TintOpacity="0.8"
                    MaterialOpacity="0.7" />
			</ExperimentalAcrylicBorder.Material>
		</ExperimentalAcrylicBorder>

		<Grid Margin="0,30,0,0">
			<!-- Add margin to account for title bar -->
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="*"/>
			</Grid.RowDefinitions>

			<!-- Header with profile info - dark gray theme -->
			<Border Grid.Row="0" Background="#2A2A2A" Margin="0" Padding="10">
				<Grid>
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="Auto"/>
						<ColumnDefinition Width="*"/>
						<ColumnDefinition Width="Auto"/>
					</Grid.ColumnDefinitions>

					<!-- Profile Image and Username -->
					<StackPanel Grid.Column="0" Orientation="Horizontal" Margin="5">
						<Border CornerRadius="25" Width="50" Height="50" ClipToBounds="True" Background="#555555">
							<Image Source="{Binding ProfileImage}" Width="50" Height="50" Stretch="UniformToFill"/>
						</Border>
						<TextBlock Text="{Binding Username}"
                                   VerticalAlignment="Center"
                                   Margin="10,0,0,0"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="#E0E0E0"/>
					</StackPanel>

					<!-- App Title -->
					<TextBlock Grid.Column="1" Text="Aniki" HorizontalAlignment="Center"
                               VerticalAlignment="Center" FontSize="24" FontWeight="Bold" Foreground="#E0E0E0"/>

					<!-- Filter by list type -->
					<StackPanel Grid.Column="2" Orientation="Horizontal" Margin="5" VerticalAlignment="Center">
						<TextBlock Text="Filter:" VerticalAlignment="Center"
                                   Margin="0,0,5,0" Foreground="#E0E0E0"/>
						<ComboBox ItemsSource="{Binding FilterOptions}"
                                  SelectedItem="{Binding SelectedFilter}"
                                  Width="150" />
					</StackPanel>
				</Grid>
			</Border>

			<!-- Loading indicator -->
			<Grid Grid.Row="1" IsVisible="{Binding IsLoading}">
				<ProgressBar IsIndeterminate="True"
                             VerticalAlignment="Center"
                             HorizontalAlignment="Center"
                             Width="300" />
			</Grid>

			<Grid Grid.Row="1" IsVisible="{Binding !IsLoading}">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="1*" />
					<ColumnDefinition Width="2*" />
				</Grid.ColumnDefinitions>

				<!-- Anime List with semi-transparent gray theme -->
				<ListBox Grid.Column="0"
						 ItemsSource="{Binding AnimeList}"
						 Background="Transparent"
						 IsVisible="{Binding !IsLoading}"
						 SelectedItem="{Binding SelectedAnime, Mode=TwoWay}"
						 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
						 ScrollViewer.VerticalScrollBarVisibility="Auto">
					<ListBox.Styles>
						<!-- Make scrollbar more visible -->
						<Style Selector="ScrollBar">
							<Setter Property="Background" Value="#333333"/>
							<Setter Property="MinWidth" Value="16"/>
						</Style>
					</ListBox.Styles>
					<ListBox.ItemTemplate>
						<DataTemplate DataType="models:AnimeData">
							<Border Padding="10" Margin="5" CornerRadius="5" Background="#3A3A3A"
									BoxShadow="2 2 4 0 #20000000">
								<Grid>
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="Auto"/>
										<ColumnDefinition Width="*"/>
										<ColumnDefinition Width="Auto"/>
									</Grid.ColumnDefinitions>

									<!-- Anime Title and Status -->
									<StackPanel Grid.Column="1" Margin="10,0">
										<TextBlock Text="{Binding Node.Title}"
												   FontWeight="Bold" FontSize="16"
												   TextWrapping="Wrap" Foreground="White"/>

										<StackPanel Orientation="Horizontal" Margin="0,5,0,0">
											<TextBlock Text="Status: " FontWeight="SemiBold" Foreground="LightGray"/>
											<TextBlock Text="{Binding ListStatus.Status}" Foreground="LightGray"/>
										</StackPanel>

										<StackPanel Orientation="Horizontal" Margin="0,2,0,0">
											<TextBlock Text="Episodes: " FontWeight="SemiBold" Foreground="LightGray"/>
											<TextBlock Text="{Binding ListStatus.Num_Episodes_Watched}" Foreground="LightGray"/>
										</StackPanel>

										<StackPanel Orientation="Horizontal" Margin="0,2,0,0">
											<TextBlock Text="Score: " FontWeight="SemiBold" Foreground="LightGray"/>
											<TextBlock Text="{Binding ListStatus.Score}" Foreground="LightGray"/>
										</StackPanel>
									</StackPanel>
								</Grid>
							</Border>
						</DataTemplate>
					</ListBox.ItemTemplate>
				</ListBox>

				<!-- Anime Details-->
				<Border
					Grid.Column="1"
					Padding="16"
					Background="#2A2A2A"
					DataContext="{Binding SelectedAnime}"
					IsVisible="{Binding SelectedAnime, Converter={StaticResource NullToBoolConverter}}">
					<StackPanel>
						<TextBlock
						  Text="{Binding Node.Title}"
						  FontSize="24"
						  FontWeight="Bold"
						  Foreground="White"
						  Margin="0,0,0,12" />

						<Grid>
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="Auto" />
								<ColumnDefinition Width="*" />
							</Grid.ColumnDefinitions>

							<Image
							  Source="{Binding Node.MainPictureUrl}"
							  Width="150"
							  Height="220"
							  Stretch="UniformToFill"
							  Grid.Column="0" />

							<StackPanel Grid.Column="1" Margin="12,0,0,0" VerticalAlignment="Top">
								<TextBlock
								  Text="{Binding ListStatus.Status}"
								  FontWeight="SemiBold"
								  Foreground="LightGray"
								  Margin="0,0,0,6" />

								<TextBlock>
									<Run Text="{Binding ListStatus.Num_Episodes_Watched}" />
									<Run Text=" / " />
									<Run Text="{Binding Node.TotalEpisodes}" />
									<Run Text="Â episodes" />
								</TextBlock>
							</StackPanel>
						</Grid>

						<ScrollViewer Margin="0,16,0,0" VerticalScrollBarVisibility="Auto">
							<TextBlock
							  Text="{Binding Node.Description}"
							  TextWrapping="Wrap"
							  Foreground="#DDD" />
						</ScrollViewer>
					</StackPanel>
				</Border>
			</Grid>
		</Grid>

		<!-- Toolbar at the bottom -->
		<Border VerticalAlignment="Bottom" Height="40" Background="#2A2A2A">
			<StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="10,0">
				<Button Content="Refresh"
                        Command="{Binding RefreshCommand}"
                        Margin="5,0"
                        Padding="10,5"/>
				<Button Content="Logout"
                        Command="{Binding LogoutCommand}"
                        Margin="5,0"
                        Padding="10,5"/>
			</StackPanel>
		</Border>
	</Panel>
</Window>